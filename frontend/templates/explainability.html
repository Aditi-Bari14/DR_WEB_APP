<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Explainable AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body>

<!-- NAVBAR -->
<div class="navbar">
    <div class="nav-left">
        <span class="logo">XAI</span>
        <span class="project-name">Explainable AI Dashboard</span>
    </div>
    <div class="nav-right">
        <a href="/dashboard">Dashboard</a>
        <a href="/view-history">History</a>
        <a href="/login">Logout</a>
    </div>
</div>

<!-- MAIN CONTAINER -->
<div class="container">

    <h2>Explainable AI (XAI)</h2>
    <p class="subtitle">
        Understanding how the model arrived at its prediction
    </p>

    <!-- PREDICTION SUMMARY -->
    <div class="xai-box">
        <h3>Prediction Summary</h3>
        <p><b>Patient ID:</b> {{ record.patient_id }}</p>
        <p><b>Prediction:</b> {{ record.prediction }}</p>
        <p><b>Confidence:</b> {{ record.confidence }}%</p>
        <p><b>Date:</b> {{ record.date }}</p>
    </div>

    <!-- VISUAL EXPLANATION -->
    <div class="xai-box">
        <h3>Visual Explanation</h3>
        <p class="description">
            Highlighted regions indicate retinal areas that contributed most to the model’s prediction.
        </p>

        <div class="xai-images">

            <!-- ORIGINAL IMAGE -->
            <div class="xai-image-box">
                <p class="img-title">Original Retina Image</p>
                <img
                    src="http://127.0.0.1:8000/uploads/{{ record.image_name }}"
                    class="xai-img"
                    alt="Original Retina Image">
            </div>

            <!-- GRAD-CAM -->
            <div class="xai-image-box">
                <p class="img-title">Grad-CAM Heatmap</p>
                {% if gradcam_image %}
                    <img src="{{ gradcam_image }}" class="xai-img" alt="Grad-CAM">
                {% else %}
                    <div class="placeholder">Not Available</div>
                {% endif %}
            </div>

            <!-- PROTOTYPE SIMILARITY -->
            <div class="xai-image-box">
                <p class="img-title">Prototype Similarity</p>
                {% if prototype_image %}
                    <img
                        src="http://127.0.0.1:8000{{ prototype_image }}"
                        class="xai-img"
                        alt="Prototype Similarity">
                {% else %}
                    <div class="placeholder">Not Available</div>
                {% endif %}
            </div>

        </div>
    </div>

    <!-- CLINICAL INTERPRETATION -->
    <div class="xai-box">
        <h3>Clinical Interpretation (Lesion-based)</h3>

        {% if clinical_data %}
        <div class="clinical-card">
            <p><b>Diagnosis:</b> {{ clinical_data.diagnosis }}</p>

            <p><b>Key Findings:</b></p>
            <ul>
                {% for item in clinical_data.findings %}
                    <li>{{ item }}</li>
                {% endfor %}
            </ul>

            <p><b>Clinical Meaning:</b> {{ clinical_data.meaning }}</p>
            <p><b>Recommendation:</b> {{ clinical_data.recommendation }}</p>
        </div>
        {% else %}
            <p class="no-data">Clinical interpretation not available.</p>
        {% endif %}
    </div>

    <!-- BACK BUTTON -->
    <div class="back-btn">
        <a href="/view-history" class="btn-primary">← Back to History</a>
    </div>

</div>

</body>
</html>
